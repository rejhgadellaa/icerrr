Number.prototype.toUInt=function(){return this<0?this+4294967296:this};Number.prototype.bytes32=function(){return[this>>>24&255,this>>>16&255,this>>>8&255,this&255]};Number.prototype.bytes16sw=function(){return[this&255,this>>>8&255]};Array.prototype.adler32=function(e,t){switch(arguments.length){case 0:e=0;case 1:t=this.length-e}var n=1,r=0;for(var i=0;i<t;i++){n=(n+this[e+i])%65521;r=(r+n)%65521}return(r<<16|n).toUInt()};Array.prototype.crc32=function(e,t){switch(arguments.length){case 0:e=0;case 1:t=this.length-e}var n=arguments.callee.crctable;if(!n){n=[];var r;for(var i=0;i<256;i++){r=i;for(var s=0;s<8;s++)r=r&1?3988292384^r>>>1:r>>>1;n[i]=r.toUInt()}arguments.callee.crctable=n}var r=4294967295;for(var o=0;o<t;o++)r=n[(r^this[e+o])&255]^r>>>8;return(r^4294967295).toUInt()};(function(){var e=function(){var e=Array.prototype.slice.call(this.getContext("2d").getImageData(0,0,this.width,this.height).data);var t=this.width;var n=this.height;var r=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82];Array.prototype.push.apply(r,t.bytes32());Array.prototype.push.apply(r,n.bytes32());r.push(8,6,0,0,0);Array.prototype.push.apply(r,r.crc32(12,17).bytes32());var i=n*(t*4+1);for(var s=0;s<n;s++)e.splice(s*(t*4+1),0,0);var o=Math.ceil(i/32768);Array.prototype.push.apply(r,(i+5*o+6).bytes32());var u=r.length;var a=i+5*o+6+4;r.push(73,68,65,84,120,1);for(var f=0;f<o;f++){var l=Math.min(32768,i-f*32768);r.push(f==o-1?1:0);Array.prototype.push.apply(r,l.bytes16sw());Array.prototype.push.apply(r,(~l).bytes16sw());var c=e.slice(f*32768,f*32768+l);Array.prototype.push.apply(r,c)}Array.prototype.push.apply(r,e.adler32().bytes32());Array.prototype.push.apply(r,r.crc32(u,a).bytes32());r.push(0,0,0,0,73,69,78,68);Array.prototype.push.apply(r,r.crc32(r.length-4,4).bytes32());return"data:image/png;base64,"+btoa(r.map(function(e){return String.fromCharCode(e)}).join(""))};var t=HTMLCanvasElement.prototype.toDataURL;HTMLCanvasElement.prototype.toDataURL=function(n){var r=t.apply(this,arguments);if(r=="data:,"){HTMLCanvasElement.prototype.toDataURL=e;return this.toDataURL()}else{HTMLCanvasElement.prototype.toDataURL=t;return r}}})()